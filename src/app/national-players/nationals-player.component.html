<div class="header-actions">
    <h2>{{ 'NATIONALS_PLAYER.TITLE' | translate }}</h2>
</div>

<!-- Filters Section -->
<div class="card-form filter-card">
    <div class="filters-grid">
        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.AGE' | translate }}</label>
            <div class="range-inputs">
                <input type="number" [(ngModel)]="filters.minAge" (change)="applyFilters()" placeholder="Min">
                <input type="number" [(ngModel)]="filters.maxAge" (change)="applyFilters()" placeholder="Max">
            </div>
        </div>
        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.NATIVE_LEAGUE_ID' | translate }}</label>
            <input type="number" [(ngModel)]="filters.nativeLeagueId" (change)="applyFilters()" placeholder="League ID">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.TSI_MIN' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minTSI" (change)="applyFilters()" placeholder="Min TSI">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.GOALKEEPING' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minKeeper" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.DEFENDING' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minDefending" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.PLAYMAKING' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minPlaymaking" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.WINGER' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minWinger" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.PASSING' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minPassing" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.SCORING' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minScoring" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.SET_PIECES' | translate }}</label>
            <input type="number" [(ngModel)]="filters.minSetPieces" (change)="applyFilters()" placeholder="Min">
        </div>

        <div class="filter-group">
            <label>{{ 'NATIONALS_PLAYER.FILTERS.SPECIALTY' | translate }}</label>
            <select [(ngModel)]="filters.specialty" (change)="applyFilters()">
                <option value="">{{ 'NATIONALS_PLAYER.FILTERS.ALL' | translate }}</option>
                <option *ngFor="let s of specialties" [value]="s.id">{{ s.label }}</option>
            </select>
        </div>

        <div class="filter-group actions">
            <button class="btn-clear" (click)="clearFilters()">{{ 'NATIONALS_PLAYER.FILTERS.CLEAR' | translate
                }}</button>
        </div>
    </div>
</div>

<!-- Lista Giocatori (Raggruppata per LeagueID) -->
<div class="card-form" *ngIf="!selectedPlayer">
    <div *ngIf="isLoading" class="loading">{{ 'MY_PLAYERS.LOADING' | translate }}</div>

    <!-- Se non ci sono gruppi (quindi players) -->
    <div *ngIf="!isLoading && (groupedPlayers | keyvalue)?.length === 0" class="no-data">
        {{ 'MY_PLAYERS.NO_PLAYERS' | translate }}
    </div>

    <!-- Itera sulle chiavi (LeagueID) -->
    <div *ngFor="let group of groupedPlayers | keyvalue" class="league-group">
        <h3>{{ 'NATIONALS_PLAYER.LEAGUE_PREFIX' | translate }} {{ group.key }}</h3>

        <div class="table-responsive">
            <table class="player-table">
                <thead>
                    <tr>
                        <th (click)="sort('FirstName')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.FIRSTNAME' | translate }}
                            <span *ngIf="sortColumn === 'FirstName'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th (click)="sort('LastName')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.LASTNAME' | translate }}
                            <span *ngIf="sortColumn === 'LastName'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th (click)="sort('PlayerID')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.PLAYERID' | translate }}
                            <span *ngIf="sortColumn === 'PlayerID'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th (click)="sort('Age')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.AGE' | translate }}
                            <span *ngIf="sortColumn === 'Age'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th (click)="sort('AgeDays')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.DAYS' | translate }}
                            <span *ngIf="sortColumn === 'AgeDays'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th (click)="sort('TSI')" class="sortable">
                            {{ 'MY_PLAYERS.TABLE.TSI' | translate }}
                            <span *ngIf="sortColumn === 'TSI'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                        </th>
                        <th>{{ 'MY_PLAYERS.TABLE.ACTION' | translate }}</th>
                        <th>{{ 'NATIONALS_PLAYER.TABLE.ADD_TO_LIST' | translate }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let p of group.value">
                        <td>{{ p.FirstName }}</td>
                        <td>{{ p.LastName }}</td>
                        <td>{{ p.PlayerID }}</td>
                        <td>{{ p.Age }}</td>
                        <td>{{ p.AgeDays }}</td>
                        <td>{{ p.TSI | number }}</td>
                        <td>
                            <button class="btn-detail" (click)="selectPlayer(p)">
                                {{ 'MY_PLAYERS.DETAIL_BUTTON' | translate }}
                            </button>
                        </td>
                        <td class="action-cell">
                            <!-- Dropdown con le liste disponibili per questa lega -->
                            <ng-container *ngIf="availableListsByLeague[group.key]?.length; else noLists">
                                <select [(ngModel)]="selectedLists[p.PlayerID]" class="list-select">
                                    <option value="" disabled selected>{{ 'NATIONALS_PLAYER.ACTIONS.SELECT_LIST' |
                                        translate }}</option>
                                    <option *ngFor="let list of availableListsByLeague[group.key]" [value]="list.id">
                                        {{ list.name }}
                                    </option>
                                </select>
                                <button class="btn-add" (click)="addPlayerToList(p)"
                                    [disabled]="!selectedLists[p.PlayerID]">
                                    {{ 'NATIONALS_PLAYER.ACTIONS.ADD' | translate }}
                                </button>
                            </ng-container>
                            <ng-template #noLists>
                                <span class="no-lists-text">-</span>
                            </ng-template>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Dettaglio Giocatore (HT Style) - Riutilizzato da MyPlayersDetail -->
<div class="player-detail-card" *ngIf="selectedPlayer">
    <button class="btn-back" (click)="closeDetail()">{{ 'MY_PLAYERS.BACK_TO_LIST' | translate }}</button>

    <div class="ht-header">
        <div class="ht-name-row">
            <span class="ht-name">{{ selectedPlayer.FirstName }} {{ selectedPlayer.LastName }}</span>
            <span class="ht-id">({{ selectedPlayer.PlayerID }})</span>
            <span *ngIf="selectedPlayer.Cards > 0" class="card-icon" [class.red]="selectedPlayer.Cards >= 3"
                [class.yellow]="selectedPlayer.Cards < 3">üü®</span>
        </div>
        <div class="ht-sub-row">
            <span class="flag-icon">üè≥Ô∏è</span>
            {{ selectedPlayer.Age }} {{ 'MY_PLAYERS.AGE_JOIN_ANNI' | translate }} {{ selectedPlayer.AgeDays }} {{
            'MY_PLAYERS.AGE_JOIN_GIORNI' | translate }}
            {{selectedPlayer.NextBirthDay | date}}
        </div>
    </div>

    <div class="ht-body">
        <div class="ht-skills-summary">
            <p>{{ selectedPlayer.PlayerForm }} {{ 'MY_PLAYERS.FORM_LABEL' | translate }} {{ selectedPlayer.StaminaSkill
                }} {{ 'MY_PLAYERS.STAMINA_LABEL' | translate }}</p>
            <p>{{ 'MY_PLAYERS.PERSONALITY_TEXT' | translate }}</p>
            <p>{{ 'MY_PLAYERS.EXPERIENCE_JOIN' | translate }} {{ selectedPlayer.Experience }} {{
                'MY_PLAYERS.EXPERIENCE_LABEL' | translate }} {{ selectedPlayer.Honesty }} {{ 'MY_PLAYERS.CHARISMA_LABEL'
                | translate }}</p>
            <p>{{ 'MY_PLAYERS.LOYALTY_TEXT' | translate }} {{ selectedPlayer.Loyalty }}.</p>
        </div>

        <div>
            {{ 'MY_PLAYERS.SKILLS_TITLE' | translate }} <br>
            {{ 'COMMON.SKILLS.goalkeeping' | translate }}: {{ selectedPlayer.KeeperSkill }} <br>
            {{ 'COMMON.SKILLS.playmaking' | translate }}: {{ selectedPlayer.PlaymakerSkill }} <br>
            {{ 'COMMON.SKILLS.scoring' | translate }}: {{ selectedPlayer.ScorerSkill }} <br>
            {{ 'COMMON.SKILLS.passing' | translate }}: {{ selectedPlayer.PassingSkill }} <br>
            {{ 'COMMON.SKILLS.winger' | translate }}: {{ selectedPlayer.WingerSkill }} <br>
            {{ 'COMMON.SKILLS.defending' | translate }}: {{ selectedPlayer.DefenderSkill }} <br>
            {{ 'COMMON.SKILLS.set pieces' | translate }}: {{ selectedPlayer.SetPiecesSkill }} <br><br>
        </div>

        <div class="ht-info-grid">
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.OWNER_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.TeamName || 'N.A.' }}</span>
            </div>
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.TSI_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.TSI | number }}</span>
            </div>
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.SALARY_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.Salary | number }} {{ 'MY_PLAYERS.SALARY_CURRENCY' | translate
                    }}</span>
            </div>
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.CARDS_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.Cards }}</span>
            </div>
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.INJURIES_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.InjuryLevel > 0 ? (selectedPlayer.InjuryLevel + ' ' +
                    ('MY_PLAYERS.WEEKS' | translate))
                    : ('MY_PLAYERS.NONE' | translate) }}</span>
            </div>
            <div class="info-row">
                <span class="label">{{ 'MY_PLAYERS.SPECIALTY_LABEL' | translate }}</span>
                <span class="value">{{ selectedPlayer.Specialty || ('MY_PLAYERS.NONE_F' | translate) }}</span>
            </div>
        </div>
    </div>
</div>